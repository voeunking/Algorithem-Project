{% extends 'base.html' %}

{% block title %}Reports | Library Management{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item active" aria-current="page">Reports</li>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/reports.css') }}">
{% endblock %}

{% block content %}
<div class="row g-4">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="row g-3 align-items-end">
          <div class="col-md-3">
            <label class="form-label">Report Type</label>
            <select id="reportType" class="form-select">
              <option value="summary">Summary</option>
              <option value="popular_books">Popular Books</option>
              <option value="transactions_by_day">Transactions by Day</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Start Date</label>
            <input type="date" id="startDate" class="form-control">
          </div>
          <div class="col-md-3">
            <label class="form-label">End Date</label>
            <input type="date" id="endDate" class="form-control">
          </div>
          <div class="col-md-3 d-flex gap-2">
            <div class="btn-group me-2">
              <button id="presetWeek" class="btn btn-sm btn-outline-secondary">7d</button>
              <button id="preset30" class="btn btn-sm btn-outline-secondary">30d</button>
              <button id="preset90" class="btn btn-sm btn-outline-secondary">90d</button>
            </div>
            <button id="runReport" class="btn btn-primary"><i class="fas fa-play me-2"></i>Run</button>
            <button id="quickLast30" class="btn btn-outline-secondary"><i class="fas fa-clock ms-2"></i></button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12" id="summaryCards" style="display:none;">
    <div class="row g-3">
      <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-title">Books</div>
          <div class="stat-value" id="statBooks">0 <span class="stat-delta" id="deltaBooks"></span></div>
          <canvas class="sparkline" id="sparkBooks" height="40"></canvas>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-title">Members</div>
          <div class="stat-value" id="statMembers">0 <span class="stat-delta" id="deltaMembers"></span></div>
          <canvas class="sparkline" id="sparkMembers" height="40"></canvas>
        </div>
      </div>
      <div class="col-md-2">
        <div class="stat-card">
          <div class="stat-title">Issued</div>
          <div class="stat-value" id="statIssued">0 <span class="stat-delta" id="deltaIssued"></span></div>
          <canvas class="sparkline" id="sparkIssued" height="40"></canvas>
        </div>
      </div>
      <div class="col-md-2">
        <div class="stat-card">
          <div class="stat-title">Returned</div>
          <div class="stat-value" id="statReturned">0 <span class="stat-delta" id="deltaReturned"></span></div>
          <canvas class="sparkline" id="sparkReturned" height="40"></canvas>
        </div>
      </div>
      <div class="col-md-2">
        <div class="stat-card">
          <div class="stat-title">Active Loans</div>
          <div class="stat-value" id="statActive">0 <span class="stat-delta" id="deltaActive"></span></div>
          <canvas class="sparkline" id="sparkActive" height="40"></canvas>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12">
    <div class="card shadow-sm mt-3">
      <div class="card-body">
        <h5 class="card-title">Saved Reports</h5>
        <p class="text-muted">Quick access to reports you've saved (demo, stored in browser).</p>
        <ul id="savedReportsList" class="list-group list-group-flush"></ul>
      </div>
    </div>
  </div>

  <div class="col-12" id="tableSection" style="display:none;">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <div>
            <h5 class="card-title mb-0">Results</h5>
            <small class="text-muted">Use the actions to export, save, or schedule this report.</small>
          </div>
          <div class="btn-group">
            <button id="exportCSV" class="btn btn-sm btn-outline-primary"><i
                class="fas fa-file-csv me-2"></i>CSV</button>
            <button id="exportPDF" class="btn btn-sm btn-outline-secondary"><i
                class="fas fa-file-pdf me-2"></i>PDF</button>
            <button id="saveReport" class="btn btn-sm btn-outline-success"><i class="fas fa-save me-2"></i>Save</button>
            <button id="scheduleReport" class="btn btn-sm btn-outline-warning"><i
                class="fas fa-calendar-alt me-2"></i>Schedule</button>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-striped align-middle" id="resultsTable">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12" id="chartSection" style="display:none;">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Chart</h5>
        <canvas id="reportChart" height="120"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Schedule Modal -->
<div class="modal fade" id="scheduleModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Schedule Report</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Frequency</label>
          <select id="schedFreq" class="form-select">
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="form-label">Send to (email)</label>
          <input id="schedEmail" class="form-control" placeholder="admin@example.com">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button id="saveSchedule" type="button" class="btn btn-primary">Save Schedule</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/reports.js') }}"></script>
{% endblock %}