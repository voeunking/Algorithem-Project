{% extends 'base.html' %}

{% block title %}Reports | Library Management{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item active" aria-current="page">Reports</li>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/reports.css') }}">
{% endblock %}

{% block content %}
<div class="row g-4">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="row g-3 align-items-end">
          <div class="col-md-3">
            <label class="form-label">Report Type</label>
            <select id="reportType" class="form-select">
              <option value="summary">Summary</option>
              <option value="popular_books">Popular Books</option>
              <option value="transactions_by_day">Transactions by Day</option>
            </select>
          </div>
          <div class="col-md-3">
            <label class="form-label">Start Date</label>
            <input type="date" id="startDate" class="form-control">
          </div>
          <div class="col-md-3">
            <label class="form-label">End Date</label>
            <input type="date" id="endDate" class="form-control">
          </div>
          <div class="col-md-3 d-flex gap-2">
            <button id="runReport" class="btn btn-primary flex-grow-1"><i class="fas fa-play me-2"></i>Run</button>
            <button id="quickLast30" class="btn btn-outline-secondary"><i class="fas fa-clock me-2"></i>Last 30d</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12" id="summaryCards" style="display:none;">
    <div class="row g-3">
      <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-title">Books</div>
          <div class="stat-value" id="statBooks">0</div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stat-card">
          <div class="stat-title">Members</div>
          <div class="stat-value" id="statMembers">0</div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="stat-card">
          <div class="stat-title">Issued</div>
          <div class="stat-value" id="statIssued">0</div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="stat-card">
          <div class="stat-title">Returned</div>
          <div class="stat-value" id="statReturned">0</div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="stat-card">
          <div class="stat-title">Active Loans</div>
          <div class="stat-value" id="statActive">0</div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12" id="tableSection" style="display:none;">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="card-title mb-0">Results</h5>
          <button id="exportCSV" class="btn btn-sm btn-outline-primary"><i class="fas fa-file-csv me-2"></i>Export CSV</button>
        </div>
        <div class="table-responsive">
          <table class="table table-striped align-middle" id="resultsTable">
            <thead></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <div class="col-12" id="chartSection" style="display:none;">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">Chart</h5>
        <canvas id="reportChart" height="120"></canvas>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/reports.js') }}"></script>
{% endblock %}
